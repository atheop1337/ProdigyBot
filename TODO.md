### Техническое задание (ТЗ) для бота управления проектами с напоминаниями и трекером задач

#### 1. **Цель проекта**
Создать Telegram-бота, который позволяет пользователям управлять проектами и задачами, получать уведомления о дедлайнах, делить задачи на подзадачи, а также делиться проектами с другими пользователями. Бот должен поддерживать мультипользовательский режим, хранить данные в SQLite с использованием асинхронной библиотеки `aiosqlite`, и интегрироваться с календарем для удобного планирования.

---

#### 2. **Основной функционал**

##### 2.1 **Регистрация пользователей**
- Пользователь взаимодействует с ботом через команду `/start`, после чего происходит регистрация в базе данных. - ✅
- Проверка наличия пользователя в базе данных при каждом обращении. - ✅
  
##### 2.2 **Создание и управление проектами**
- Команда `/new_project` — создание нового проекта с указанием названия и описания. - ✅
- Команда `/edit_project` — редактирование названия и описания существующего проекта. - ✅
- Команда `/delete_project` — удаление проекта. - ✅
- Список проектов доступен через команду `/projects`. - ✅

##### 2.3 **Создание и управление задачами**
- Команда `/add_task` — добавление задачи в существующий проект с указанием дедлайна, приоритета и подзадач. - ✅
- Команда `/edit_task` — редактирование задачи (например, изменение дедлайна, описания, приоритета): изменение прогресса, все отстальное юзелесс по факту - ✅
- Команда `/delete_task` — удаление задачи. - ✅
- Команда `/tasks` — просмотр списка задач для выбранного проекта, с сортировкой по дедлайну или приоритету.

##### 2.4 **Подзадачи**
- Возможность для каждой задачи добавить подзадачи через команду `/add_subtask`.
- Подзадачи могут быть выполнены отдельно от основной задачи.

##### 2.5 **Уведомления о дедлайнах**
- Автоматическая отправка уведомлений пользователю за 1 день до дедлайна задачи и в день дедлайна.
- Пользователь может включить или отключить уведомления через команду `/notifications`.

##### 2.6 **Отслеживание прогресса**
- Задачи могут иметь статус: "в процессе", "выполнено".
- Возможность отслеживать прогресс выполнения задач и подзадач (команда `/progress`).
- Статистика завершенных и активных задач.

##### 2.7 **Деление проектов с другими пользователями**
- Команда `/share_project` — возможность поделиться проектом с другим пользователем через указание его ID или username.
- Совместное управление проектом для добавленных пользователей.

##### 2.8 **Интеграция с календарем**
- Поддержка интеграции с Google Calendar через API.
- Возможность синхронизировать дедлайны задач с календарем пользователя (команда `/sync_calendar`).
  
---

#### 3. **База данных (SQLite, aiosqlite)**
- **Таблица пользователей (`users`)**
  - `id` (INTEGER, primary key)
  - `username` (TEXT)
  - `chat_id` (INTEGER)
  - `notifications_enabled` (BOOLEAN)
  
- **Таблица проектов (`projects`)**
  - `id` (INTEGER, primary key)
  - `user_id` (INTEGER, foreign key на `users`)
  - `name` (TEXT)
  - `description` (TEXT)
  
- **Таблица задач (`tasks`)**
  - `id` (INTEGER, primary key)
  - `project_id` (INTEGER, foreign key на `projects`)
  - `name` (TEXT)
  - `description` (TEXT)
  - `deadline` (DATETIME)
  - `priority` (INTEGER)
  - `status` (TEXT, значения: "в процессе", "выполнено")
  
- **Таблица подзадач (`subtasks`)**
  - `id` (INTEGER, primary key)
  - `task_id` (INTEGER, foreign key на `tasks`)
  - `name` (TEXT)
  - `status` (TEXT, значения: "в процессе", "выполнено")

- **Таблица пользователей в совместных проектах (`shared_projects`)**
  - `project_id` (INTEGER, foreign key на `projects`)
  - `user_id` (INTEGER, foreign key на `users`)

---

#### 4. **Интерфейс пользователя**

##### 4.1 **Основные команды**
- `/start` — начало работы, регистрация пользователя.
- `/help` — вывод списка доступных команд.
- `/new_project` — создание нового проекта.
- `/edit_project` — редактирование проекта.
- `/delete_project` — удаление проекта.
- `/projects` — просмотр списка проектов.
- `/add_task` — добавление задачи в проект.
- `/edit_task` — редактирование задачи.
- `/delete_task` — удаление задачи.
- `/tasks` — просмотр задач проекта.
- `/add_subtask` — добавление подзадачи.
- `/progress` — просмотр прогресса выполнения задач.
- `/notifications` — включение/выключение уведомлений.
- `/share_project` — поделиться проектом.
- `/sync_calendar` — синхронизация с Google Calendar.

##### 4.2 **Диалоговые окна и инлайн-клавиатуры**
- Интерактивные диалоги при создании проектов и задач (запрос названия, описания, дедлайнов и приоритетов).
- Инлайн-клавиатуры для управления задачами, переключения статусов задач/подзадач, выбора проектов и пользователей.

---

#### 5. **Дополнительные требования**
- **Асинхронная работа**: Использование `aiogram` и `aiosqlite` для асинхронных операций с базой данных и работы с API.
- **Уведомления**: Использование background-задач для отправки уведомлений (например, через `aiogram.utils.executor`).
- **Интеграция с Google Calendar**: Работа с OAuth2 для получения доступа к Google Calendar пользователя.

---

#### 6. **План разработки**
1. Реализовать основные команды для работы с проектами и задачами.
2. Настроить асинхронное взаимодействие с базой данных.
3. Добавить функционал уведомлений и интеграции с календарем.
4. Тестировать на нескольких пользователях.
5. Реализовать совместную работу над проектами и синхронизацию.

---

#### 7. **Технические ограничения**
- Бот должен работать с использованием Python 3.8+ и библиотеки `aiogram` для обработки Telegram API.
- Использование SQLite с асинхронной библиотекой `aiosqlite` для хранения данных.
